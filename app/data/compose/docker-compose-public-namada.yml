version: "3.8"

services:
  namada:
    restart: unless-stopped
    hostname: namada
    image: cerc/namada:local
    entrypoint: ["sh", "/docker-entrypoint-scripts.d/start-node.sh"]
    volumes:
      - ../config/mainnet-namada/start-node.sh:/docker-entrypoint-scripts.d/start-node.sh
      - namada_data:/root/.local/share/namada
    environment:
      - CHAIN_ID=$CHAIN_ID
      - EXTIP=$EXTIP
      - RPC_LISTEN_ADDR=$RPC_LISTEN_ADDR
      - RPC_CORS_ALLOWED=$RPC_CORS_ALLOWED
      - INDEXER=$INDEXER
      - PROM_ENABLE=$PROM_ENABLE
      - PROM_PORT=$PROM_PORT
      - CONFIGS_SERVER=${CONFIGS_SERVER:-""}
    ports:
      - "${P2P_PORT:-26656}:26656" # p2p
      - "${RPC_PORT:-26657}:26657" # http rpc
      - "${PROM_PORT:-26660}:26660" # prometheus

volumes:
  # namada_data:
  namada_data:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: "${NAMADA_DATA_DIR:-/home/.local/share/namada}"
